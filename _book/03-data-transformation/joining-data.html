<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.20">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>13&nbsp; Datensätze verbinden – Hands-On Exploratory Data Analytics</title>
<style>
/* Default styles provided by pandoc.
** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
*/
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../04-data-visualization/grammar-of-graphics.html" rel="next">
<link href="../03-data-transformation/summarize.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-3512cbed9e2527d986e9b0b56d261405.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-2aba14264cc3e83a53bc9b44aa83aa68.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script><link rel="stylesheet" href="../styles/sidebar.css">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../03-data-transformation/loading-data.html">Datentransformation</a></li><li class="breadcrumb-item"><a href="../03-data-transformation/joining-data.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Datensätze verbinden</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Hands-On Exploratory Data Analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vorwort</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Hintergründe</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-background/empirical-research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Empirische Forschung</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Erste Schritte mit R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-r-basics/ide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Entwicklungsumgebung</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-r-basics/programming-with-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Programmieren mit R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-r-basics/data-representation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Datenrepräsentation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Datentransformation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/loading-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Daten laden</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/pipe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pipe-Operator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/exploring-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Daten kennenlernen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/select.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Variablen auswählen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/mutate-modify.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Variablen verändern</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/mutate-add.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Variablen erstellen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Beobachtungen auswählen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/summarize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Beobachtungen zusammenfassen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/joining-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Datensätze verbinden</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Datenvisualisierung</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/grammar-of-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Grammar of Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/bar-charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Balkendiagramme</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/scatter-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Punktediagramme</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/histograms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Histogramme</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/boxplots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Boxplots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/line-charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Liniendiagramme</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/visualizations-polish.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Visualisuerungen polieren</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Projekt 1: Umfragen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-1-survey/survey-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Umfragedaten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-1-survey/types-of-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Arten von Variablen</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Projekt 2: News</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-2-news/load.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Laden der Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-2-news/factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Faktoren</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-2-news/variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Übersicht der Variablen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-2-news/time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Zeit</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendix/appendix-a-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anhang A: Scraping</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendix/appendix-b-supplemental.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anhang A: Material</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quellen</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
<li><a href="#sec-joining-data-beispiel" id="toc-sec-joining-data-beispiel" class="nav-link active" data-scroll-target="#sec-joining-data-beispiel"><span class="header-section-number">13.1</span> Beispieldaten</a></li>
  <li><a href="#sec-joining-data-grundprinzip" id="toc-sec-joining-data-grundprinzip" class="nav-link" data-scroll-target="#sec-joining-data-grundprinzip"><span class="header-section-number">13.2</span> Das Grundprinzip</a></li>
  <li>
<a href="#sec-joining-data-typen" id="toc-sec-joining-data-typen" class="nav-link" data-scroll-target="#sec-joining-data-typen"><span class="header-section-number">13.3</span> Join-Typen</a>
  <ul class="collapse">
<li><a href="#inner_join" id="toc-inner_join" class="nav-link" data-scroll-target="#inner_join"><code>inner_join()</code></a></li>
  <li><a href="#left_join" id="toc-left_join" class="nav-link" data-scroll-target="#left_join"><code>left_join()</code></a></li>
  <li><a href="#right_join" id="toc-right_join" class="nav-link" data-scroll-target="#right_join"><code>right_join()</code></a></li>
  <li><a href="#full_join" id="toc-full_join" class="nav-link" data-scroll-target="#full_join"><code>full_join()</code></a></li>
  <li><a href="#%C3%BCbersicht" id="toc-übersicht" class="nav-link" data-scroll-target="#%C3%BCbersicht">Übersicht</a></li>
  </ul>
</li>
  <li>
<a href="#sec-joining-data-keys" id="toc-sec-joining-data-keys" class="nav-link" data-scroll-target="#sec-joining-data-keys"><span class="header-section-number">13.4</span> Schlüssel festlegen</a>
  <ul class="collapse">
<li><a href="#automatische-erkennung" id="toc-automatische-erkennung" class="nav-link" data-scroll-target="#automatische-erkennung">Automatische Erkennung</a></li>
  <li><a href="#unterschiedliche-spaltennamen" id="toc-unterschiedliche-spaltennamen" class="nav-link" data-scroll-target="#unterschiedliche-spaltennamen">Unterschiedliche Spaltennamen</a></li>
  <li><a href="#mehrere-schl%C3%BCsselspalten" id="toc-mehrere-schlüsselspalten" class="nav-link" data-scroll-target="#mehrere-schl%C3%BCsselspalten">Mehrere Schlüsselspalten</a></li>
  </ul>
</li>
  <li><a href="#sec-joining-data-kardinalitaet" id="toc-sec-joining-data-kardinalitaet" class="nav-link" data-scroll-target="#sec-joining-data-kardinalitaet"><span class="header-section-number">13.5</span> Duplikate und Kardinalität</a></li>
  <li>
<a href="#sec-joining-data-filtering" id="toc-sec-joining-data-filtering" class="nav-link" data-scroll-target="#sec-joining-data-filtering"><span class="header-section-number">13.6</span> Filtering-Joins</a>
  <ul class="collapse">
<li><a href="#semi_join" id="toc-semi_join" class="nav-link" data-scroll-target="#semi_join"><code>semi_join()</code></a></li>
  <li><a href="#anti_join" id="toc-anti_join" class="nav-link" data-scroll-target="#anti_join"><code>anti_join()</code></a></li>
  </ul>
</li>
  <li>
<a href="#sec-joining-data-real" id="toc-sec-joining-data-real" class="nav-link" data-scroll-target="#sec-joining-data-real"><span class="header-section-number">13.7</span> Joins mit echten Daten</a>
  <ul class="collapse">
<li><a href="#fehlende-treffer-finden" id="toc-fehlende-treffer-finden" class="nav-link" data-scroll-target="#fehlende-treffer-finden">Fehlende Treffer finden</a></li>
  <li><a href="#spaltenkonflikte" id="toc-spaltenkonflikte" class="nav-link" data-scroll-target="#spaltenkonflikte">Spaltenkonflikte</a></li>
  </ul>
</li>
  <li><a href="#sec-joining-data-zusammenfassung" id="toc-sec-joining-data-zusammenfassung" class="nav-link" data-scroll-target="#sec-joining-data-zusammenfassung"><span class="header-section-number">13.8</span> Kurz zusammengefasst</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../03-data-transformation/loading-data.html">Datentransformation</a></li><li class="breadcrumb-item"><a href="../03-data-transformation/joining-data.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Datensätze verbinden</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-joining-data" class="quarto-section-identifier"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Datensätze verbinden</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Nachdem ihr nun alle grundlegenden Operationen für einzelne Datensätze wie Filtern, Modifizieren und Aggregieren beherrscht, fehlt noch der Blick über den Tellerrand einer einzelnen Tabelle. In der Praxis liegen Daten fast nie in einer einzigen, sauberen Datei vor. Kundeninformationen stehen in einer Tabelle, Bestellungen in einer anderen und Produktdetails in einer dritten. In diesem Kapitel lernt ihr, wie ihr getrennte Datensätze über gemeinsame Schlüsselspalten – sogenannte Joins – zusammenführt.</p>
<p>Die Fähigkeit, relationale Datenstrukturen aufzulösen, ist für reale Datenprojekte essenziell. Erst durch das Verknüpfen verschiedener Tabellen erhaltet ihr einen vollständigen Datensatz, in dem sich wirklich komplexe Fragen beantworten lassen. Stellt euch zwei Karteikästen vor: Einer enthält Kundennamen, der andere deren Bestellungen. Um zu wissen, welche Person was gekauft hat, braucht ihr einen Join. Das <code>dplyr</code>-Paket bietet hierfür verschiedene Varianten an, mit denen ihr exakt steuern könnt, welche Daten nach der Verknüpfung behalten oder verworfen werden.</p>
<p>Die folgende Tabelle zeigt die Funktionen, die wir in diesem Abschnitt kennenlernen.</p>
<table class="caption-top table">
<thead><tr class="header">
<th>Funktion</th>
<th>Beschreibung</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>inner_join()</code></td>
<td>Nur Zeilen mit Treffern in beiden Tabellen behalten</td>
</tr>
<tr class="even">
<td><code>left_join()</code></td>
<td>Alle Zeilen der linken Tabelle behalten</td>
</tr>
<tr class="odd">
<td><code>right_join()</code></td>
<td>Alle Zeilen der rechten Tabelle behalten</td>
</tr>
<tr class="even">
<td><code>full_join()</code></td>
<td>Alle Zeilen aus beiden Tabellen behalten</td>
</tr>
<tr class="odd">
<td><code>semi_join()</code></td>
<td>Linke Tabelle filtern (Treffer behalten)</td>
</tr>
<tr class="even">
<td><code>anti_join()</code></td>
<td>Linke Tabelle filtern (Nicht-Treffer behalten)</td>
</tr>
<tr class="odd">
<td><code>join_by()</code></td>
<td>Schlüssel bei unterschiedlichen Spaltennamen angeben</td>
</tr>
</tbody>
</table>
<p>Um die Mechanismen der einzelnen Joins bestmöglich zu verstehen, nutzen wir zunächst stark vereinfachte Beispieldaten.</p>
<section id="sec-joining-data-beispiel" class="level2" data-number="13.1"><h2 data-number="13.1" class="anchored" data-anchor-id="sec-joining-data-beispiel">
<span class="header-section-number">13.1</span> Beispieldaten</h2>
<p>Um die verschiedenen Join-Typen zu verstehen, arbeiten wir mit zwei kleinen Tabellen, die wir selbst erstellen. So seht ihr genau, was passiert.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">customers</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  customer_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Anna"</span>, <span class="st">"Ben"</span>, <span class="st">"Cleo"</span>, <span class="st">"David"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">purchases</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  purchase_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">101</span>, <span class="fl">102</span>, <span class="fl">103</span>, <span class="fl">104</span><span class="op">)</span>,</span>
<span>  customer_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>  product <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Laptop"</span>, <span class="st">"Mouse"</span>, <span class="st">"Keyboard"</span>, <span class="st">"Monitor"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Beachtet: Anna (ID 1) hat eine Bestellung, Ben (ID 2) hat zwei, Cleo (ID 3) und David (ID 4) haben keine, und es gibt eine Bestellung von Kunde 5, der gar nicht in der Kundentabelle steht. Diese Ungleichheiten sind absichtlich, denn sie zeigen, wie sich die verschiedenen Join-Typen verhalten.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">customers</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  customer_id name 
        &lt;dbl&gt; &lt;chr&gt;
1           1 Anna 
2           2 Ben  
3           3 Cleo 
4           4 David</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">purchases</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  purchase_id customer_id product 
        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;   
1         101           1 Laptop  
2         102           2 Mouse   
3         103           2 Keyboard
4         104           5 Monitor </code></pre>
</div>
</div>
</section><section id="sec-joining-data-grundprinzip" class="level2" data-number="13.2"><h2 data-number="13.2" class="anchored" data-anchor-id="sec-joining-data-grundprinzip">
<span class="header-section-number">13.2</span> Das Grundprinzip</h2>
<p>Ein Join verbindet zwei Tabellen über eine oder mehrere gemeinsame Spalten, die sogenannten <strong>Schlüssel</strong> (keys). Für jede Zeile in der linken Tabelle sucht R passende Zeilen in der rechten Tabelle, und umgekehrt. Was mit Zeilen passiert, die keinen Partner finden, hängt vom Join-Typ ab.</p>
<p><em>Abbildung: Zwei Tabellen nebeneinander. Links “customers” mit den Spalten customer_id und name, rechts “purchases” mit den Spalten purchase_id, customer_id und product. Gestrichelte Linien verbinden die customer_id-Werte, die in beiden Tabellen vorkommen (1, 2). Die customer_id 3 und 4 in der linken Tabelle und die customer_id 5 in der rechten Tabelle haben keine Verbindung. Unter den Tabellen steht “Schlüssel: customer_id”.</em></p>
</section><section id="sec-joining-data-typen" class="level2" data-number="13.3"><h2 data-number="13.3" class="anchored" data-anchor-id="sec-joining-data-typen">
<span class="header-section-number">13.3</span> Join-Typen</h2>
<section id="inner_join" class="level3"><h3 class="anchored" data-anchor-id="inner_join"><code>inner_join()</code></h3>
<p><code>inner_join()</code> behält nur die Zeilen, die in beiden Tabellen einen passenden Partner haben. Alles ohne Treffer fällt raus.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">customers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">purchases</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  customer_id name  purchase_id product 
        &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   
1           1 Anna          101 Laptop  
2           2 Ben           102 Mouse   
3           2 Ben           103 Keyboard</code></pre>
</div>
</div>
<p>Anna und Ben tauchen auf, weil ihre IDs in beiden Tabellen vorkommen. Cleo und David (keine Bestellung) und Kunde 5 (nicht in der Kundentabelle) fehlen. Ben hat zwei Zeilen, weil er zwei Bestellungen hat.</p>
</section><section id="left_join" class="level3"><h3 class="anchored" data-anchor-id="left_join"><code>left_join()</code></h3>
<p><code>left_join()</code> behält alle Zeilen der <strong>linken</strong> Tabelle. Wenn es in der rechten Tabelle keinen Treffer gibt, werden die Spalten der rechten Tabelle mit <code>NA</code> aufgefüllt.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">customers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">purchases</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  customer_id name  purchase_id product 
        &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   
1           1 Anna          101 Laptop  
2           2 Ben           102 Mouse   
3           2 Ben           103 Keyboard
4           3 Cleo           NA &lt;NA&gt;    
5           4 David          NA &lt;NA&gt;    </code></pre>
</div>
</div>
<p>Jetzt erscheinen auch Cleo und David, allerdings mit <code>NA</code> in den Bestellspalten. Die Bestellung von Kunde 5 fehlt weiterhin, weil er nicht in der linken Tabelle (customers) steht.</p>
<p><code>left_join()</code> ist der mit Abstand häufigste Join-Typ. Er garantiert, dass keine Zeilen aus eurer Haupttabelle verloren gehen.</p>
</section><section id="right_join" class="level3"><h3 class="anchored" data-anchor-id="right_join"><code>right_join()</code></h3>
<p><code>right_join()</code> ist das Spiegelbild von <code>left_join()</code>: Es behält alle Zeilen der <strong>rechten</strong> Tabelle.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">customers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">right_join</span><span class="op">(</span><span class="va">purchases</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  customer_id name  purchase_id product 
        &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   
1           1 Anna          101 Laptop  
2           2 Ben           102 Mouse   
3           2 Ben           103 Keyboard
4           5 &lt;NA&gt;          104 Monitor </code></pre>
</div>
</div>
<p>Jetzt taucht Kunde 5 auf (mit <code>NA</code> beim Namen), aber Cleo und David fehlen, weil sie keine Bestellungen haben. In der Praxis kommt <code>right_join()</code> selten vor, weil ihr den gleichen Effekt erzielen könnt, indem ihr die Reihenfolge der Tabellen tauscht und <code>left_join()</code> verwendet.</p>
</section><section id="full_join" class="level3"><h3 class="anchored" data-anchor-id="full_join"><code>full_join()</code></h3>
<p><code>full_join()</code> behält alle Zeilen aus beiden Tabellen, egal ob es einen Treffer gibt oder nicht. Fehlende Werte werden mit <code>NA</code> aufgefüllt.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">customers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">full_join</span><span class="op">(</span><span class="va">purchases</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  customer_id name  purchase_id product 
        &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   
1           1 Anna          101 Laptop  
2           2 Ben           102 Mouse   
3           2 Ben           103 Keyboard
4           3 Cleo           NA &lt;NA&gt;    
5           4 David          NA &lt;NA&gt;    
6           5 &lt;NA&gt;          104 Monitor </code></pre>
</div>
</div>
<p>Hier ist wirklich alles dabei: Anna und Ben mit ihren Bestellungen, Cleo und David ohne Bestellungen, und Kunde 5 ohne Namen.</p>
</section><section id="übersicht" class="level3"><h3 class="anchored" data-anchor-id="übersicht">Übersicht</h3>
<table class="caption-top table">
<thead><tr class="header">
<th>Join-Typ</th>
<th>Behält Zeilen aus</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>inner_join()</code></td>
<td>Nur Zeilen mit Treffer in beiden Tabellen</td>
</tr>
<tr class="even">
<td><code>left_join()</code></td>
<td>Alle Zeilen der linken Tabelle</td>
</tr>
<tr class="odd">
<td><code>right_join()</code></td>
<td>Alle Zeilen der rechten Tabelle</td>
</tr>
<tr class="even">
<td><code>full_join()</code></td>
<td>Alle Zeilen aus beiden Tabellen</td>
</tr>
</tbody>
</table>
<p><em>Abbildung: Vier kleine Diagramme nebeneinander, eines pro Join-Typ. Jedes Diagramm zeigt zwei Mengen (Kreise oder Rechtecke) als Venn-Diagramm. Die farblich hervorgehobene Fläche zeigt, welche Zeilen im Ergebnis enthalten sind. Bei inner_join ist nur die Schnittmenge farbig. Bei left_join ist der gesamte linke Kreis farbig. Bei right_join ist der gesamte rechte Kreis farbig. Bei full_join sind beide Kreise vollständig farbig. Unter jedem Diagramm steht der Funktionsname.</em></p>
</section></section><section id="sec-joining-data-keys" class="level2" data-number="13.4"><h2 data-number="13.4" class="anchored" data-anchor-id="sec-joining-data-keys">
<span class="header-section-number">13.4</span> Schlüssel festlegen</h2>
<section id="automatische-erkennung" class="level3"><h3 class="anchored" data-anchor-id="automatische-erkennung">Automatische Erkennung</h3>
<p>Wenn ihr <code>by</code> nicht angebt, sucht <code>dplyr</code> automatisch nach Spalten mit dem gleichen Namen in beiden Tabellen und nutzt diese als Schlüssel:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">customers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">purchases</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(customer_id)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  customer_id name  purchase_id product 
        &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   
1           1 Anna          101 Laptop  
2           2 Ben           102 Mouse   
3           2 Ben           103 Keyboard</code></pre>
</div>
</div>
<p>Die Meldung zeigt euch, welche Spalte als Schlüssel verwendet wurde. Das funktioniert gut, wenn die Spaltennamen eindeutig sind. Allerdings ist es besser, den Schlüssel immer explizit anzugeben, damit der Code auch dann korrekt bleibt, wenn sich die Daten ändern.</p>
</section><section id="unterschiedliche-spaltennamen" class="level3"><h3 class="anchored" data-anchor-id="unterschiedliche-spaltennamen">Unterschiedliche Spaltennamen</h3>
<p>Wenn die Schlüsselspalten in den beiden Tabellen unterschiedlich heißen, nutzt ihr <code>join_by()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">orders_renamed</span> <span class="op">&lt;-</span> <span class="va">purchases</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">rename</span><span class="op">(</span>buyer_id <span class="op">=</span> <span class="va">customer_id</span><span class="op">)</span></span>
<span></span>
<span><span class="va">customers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">orders_renamed</span>, by <span class="op">=</span> <span class="fu">join_by</span><span class="op">(</span><span class="va">customer_id</span> <span class="op">==</span> <span class="va">buyer_id</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  customer_id name  purchase_id product 
        &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;   
1           1 Anna          101 Laptop  
2           2 Ben           102 Mouse   
3           2 Ben           103 Keyboard</code></pre>
</div>
</div>
<p><code>join_by()</code> ist die moderne Syntax in <code>dplyr</code>. Die ältere Schreibweise <code>by = c("customer_id" = "buyer_id")</code> funktioniert ebenfalls, ist aber weniger lesbar.</p>
</section><section id="mehrere-schlüsselspalten" class="level3"><h3 class="anchored" data-anchor-id="mehrere-schlüsselspalten">Mehrere Schlüsselspalten</h3>
<p>Manchmal braucht ihr mehr als eine Spalte, um die Zuordnung eindeutig zu machen. Das passiert zum Beispiel, wenn ihr Daten nach Jahr und Monat verknüpfen wollt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">revenue</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2024</span>, <span class="fl">2024</span>, <span class="fl">2025</span><span class="op">)</span>,</span>
<span>  month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  total <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5000</span>, <span class="fl">6200</span>, <span class="fl">5800</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2024</span>, <span class="fl">2024</span>, <span class="fl">2025</span><span class="op">)</span>,</span>
<span>  month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5500</span>, <span class="fl">6000</span>, <span class="fl">6000</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">revenue</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">left_join</span><span class="op">(</span><span class="va">targets</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"month"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
   year month total target
  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  2024     1  5000   5500
2  2024     2  6200   6000
3  2025     1  5800   6000</code></pre>
</div>
</div>
</section></section><section id="sec-joining-data-kardinalitaet" class="level2" data-number="13.5"><h2 data-number="13.5" class="anchored" data-anchor-id="sec-joining-data-kardinalitaet">
<span class="header-section-number">13.5</span> Duplikate und Kardinalität</h2>
<p>Bei Joins können sich Zeilen vervielfachen. Das habt ihr schon bei Ben gesehen: Weil er zwei Bestellungen hat, erscheint sein Name im Ergebnis zweimal. Das nennt man eine <strong>Eins-zu-Viele-Beziehung</strong> (one-to-many).</p>
<p>Was passiert bei einer <strong>Viele-zu-Viele-Beziehung</strong> (many-to-many)? Dann bildet R das kartesische Produkt, also jede mögliche Kombination:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">left</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, value_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="st">"b"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">right</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>key <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, value_right <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">left</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">right</span>, by <span class="op">=</span> <span class="st">"key"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in inner_join(left, right, by = "key"): Detected an unexpected many-to-many relationship between `x` and `y`.
ℹ Row 1 of `x` matches multiple rows in `y`.
ℹ Row 1 of `y` matches multiple rows in `x`.
ℹ If a many-to-many relationship is expected, set `relationship =
  "many-to-many"` to silence this warning.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
    key value_left value_right
  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      
1     1 a          x          
2     1 a          y          
3     1 b          x          
4     1 b          y          </code></pre>
</div>
</div>
<p>Aus zwei Zeilen links und zwei Zeilen rechts werden vier Zeilen. In der Praxis ist das fast immer ein Zeichen dafür, dass euer Schlüssel nicht eindeutig genug ist. <code>dplyr</code> gibt euch deshalb eine Warnung aus.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Zeilenzahl prüfen">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tipp</span>Zeilenzahl prüfen
</div>
</div>
<div class="callout-body-container callout-body">
<p>Prüft nach jedem Join kurz mit <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code>, ob die Zeilenzahl plausibel ist. Wenn sie unerwartet steigt, habt ihr wahrscheinlich Duplikate im Schlüssel. Mit <code>count(key, sort = TRUE)</code> findet ihr die Übeltäter.</p>
</div>
</div>
</section><section id="sec-joining-data-filtering" class="level2" data-number="13.6"><h2 data-number="13.6" class="anchored" data-anchor-id="sec-joining-data-filtering">
<span class="header-section-number">13.6</span> Filtering-Joins</h2>
<p>Neben den verbindenden Joins gibt es auch <strong>Filtering-Joins</strong>. Sie verändern die Spalten nicht, sondern filtern nur die Zeilen der linken Tabelle.</p>
<section id="semi_join" class="level3"><h3 class="anchored" data-anchor-id="semi_join"><code>semi_join()</code></h3>
<p><code>semi_join()</code> behält die Zeilen der linken Tabelle, für die es einen Treffer in der rechten Tabelle gibt. Es fügt aber keine Spalten der rechten Tabelle hinzu:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">customers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">semi_join</span><span class="op">(</span><span class="va">purchases</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  customer_id name 
        &lt;dbl&gt; &lt;chr&gt;
1           1 Anna 
2           2 Ben  </code></pre>
</div>
</div>
<p>Nur Anna und Ben erscheinen, weil sie Bestellungen haben. Aber die Bestellspalten fehlen. Das Ergebnis sieht aus wie ein <code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>, und genau das ist der Zweck: Ihr filtert die Kundentabelle danach, welche Kunden überhaupt Bestellungen haben.</p>
</section><section id="anti_join" class="level3"><h3 class="anchored" data-anchor-id="anti_join"><code>anti_join()</code></h3>
<p><code>anti_join()</code> ist das Gegenstück: Es behält die Zeilen der linken Tabelle, für die es <strong>keinen</strong> Treffer in der rechten Tabelle gibt.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">customers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">anti_join</span><span class="op">(</span><span class="va">purchases</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  customer_id name 
        &lt;dbl&gt; &lt;chr&gt;
1           3 Cleo 
2           4 David</code></pre>
</div>
</div>
<p>Cleo und David erscheinen, weil sie keine Bestellungen haben. <code>anti_join()</code> ist perfekt, um fehlende Zuordnungen zu finden, also Daten, die in einer Tabelle vorhanden sind, aber in der anderen fehlen.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">purchases</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">anti_join</span><span class="op">(</span><span class="va">customers</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  purchase_id customer_id product
        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  
1         104           5 Monitor</code></pre>
</div>
</div>
<p>Hier findet ihr die Bestellung von Kunde 5, die keinem Kunden zugeordnet werden kann. Das ist ein typischer Einsatz bei der Datenqualitätsprüfung.</p>
<p><em>Abbildung: Zwei Diagramme nebeneinander. Links: semi_join. Zwei Tabellen “customers” und “purchases”. Der Pfeil zeigt von purchases auf customers. In der customers-Tabelle sind die Zeilen mit Treffern (Anna, Ben) hervorgehoben. Die purchases-Spalten werden NICHT hinzugefügt. Rechts: anti_join. Gleicher Aufbau, aber in der customers-Tabelle sind die Zeilen OHNE Treffer (Cleo, David) hervorgehoben.</em></p>
</section></section><section id="sec-joining-data-real" class="level2" data-number="13.7"><h2 data-number="13.7" class="anchored" data-anchor-id="sec-joining-data-real">
<span class="header-section-number">13.7</span> Joins mit echten Daten</h2>
<p>Schauen wir uns einen Join mit dem <code>tweets</code>-Datensatz an. Im Ordner <code>data/</code> liegt eine CSV-Datei, die den Twitter-Accounts der Ampel-Politiker ihre Parteizugehörigkeit zuordnet. So eine Lookup-Tabelle ist ein typischer Anwendungsfall für Joins: Die Information steckt in einer separaten Datei, und ihr bringt sie per Join in euren Hauptdatensatz.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">party_info</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/party_info.csv"</span><span class="op">)</span></span>
<span><span class="va">party_info</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 2
   screen_name     party
   &lt;chr&gt;           &lt;chr&gt;
 1 ABaerbock       Grüne
 2 ABaerbockArchiv Grüne
 3 Bundeskanzler   SPD  
 4 c_lindner       FDP  
 5 cem_oezdemir    Grüne
 6 hubertus_heil   SPD  
 7 Karl_Lauterbach SPD  
 8 klara_geywitz   SPD  
 9 lisapaus        Grüne
10 MarcoBuschmann  FDP  
11 NancyFaeser     SPD  
12 OlafScholz      SPD  
13 starkwatzinger  FDP  
14 SteffiLemke     Grüne
15 SvenjaSchulze68 SPD  
16 W_Schmidt_      SPD  
17 Wissing         FDP  </code></pre>
</div>
</div>
<p>Jetzt verbinden wir die Parteizugehörigkeit mit den Tweets und berechnen die durchschnittliche Interaktion pro Partei: tweets |&gt; inner_join(party_info, by = “screen_name”) |&gt; filter(!is_retweet) |&gt; group_by(party) |&gt; summarise( tweets = n(), avg_retweets = mean(retweet_count, na.rm = TRUE), .groups = “drop” )</p>
<pre><code>
Hier seht ihr, wie sich ein Join nahtlos in eine Pipe-Kette einreiht: Erst verbinden, dann filtern und zusammenfassen. Das ist ein typisches Muster in der Praxis.

## Typische Probleme {#sec-joining-data-probleme}

### Unerwartete Duplikate

Wenn euer Ergebnis plötzlich viel mehr Zeilen hat als erwartet, prüft die Eindeutigkeit eurer Schlüssel:


::: {.cell}

```{.r .cell-code}
purchases |&gt;
  count(customer_id, sort = TRUE)</code></pre>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  customer_id     n
        &lt;dbl&gt; &lt;int&gt;
1           2     2
2           1     1
3           5     1</code></pre>
</div>
<p>:::</p>
<p>Wenn dieselbe ID mehrfach vorkommt, bekommt ihr für jede Kombination eine Zeile.</p>
<section id="fehlende-treffer-finden" class="level3"><h3 class="anchored" data-anchor-id="fehlende-treffer-finden">Fehlende Treffer finden</h3>
<p>Um herauszufinden, welche Zeilen beim Join verloren gehen, nutzt <code>anti_join()</code> in beide Richtungen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Kunden ohne Bestellungen</span></span>
<span><span class="va">customers</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">anti_join</span><span class="op">(</span><span class="va">purchases</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  customer_id name 
        &lt;dbl&gt; &lt;chr&gt;
1           3 Cleo 
2           4 David</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Bestellungen ohne Kunden</span></span>
<span><span class="va">purchases</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">anti_join</span><span class="op">(</span><span class="va">customers</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  purchase_id customer_id product
        &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;  
1         104           5 Monitor</code></pre>
</div>
</div>
</section><section id="spaltenkonflikte" class="level3"><h3 class="anchored" data-anchor-id="spaltenkonflikte">Spaltenkonflikte</h3>
<p>Wenn beide Tabellen Spalten mit dem gleichen Namen haben, die keine Schlüssel sind, hängt <code>dplyr</code> automatisch Suffixe an:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ratings_a</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>customer_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, rating <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ratings_b</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>customer_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, rating <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ratings_a</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">ratings_b</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  customer_id rating.x rating.y
        &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1           1        4        3
2           2        5        4</code></pre>
</div>
</div>
<p>Ihr könnt die Suffixe über den Parameter <code>suffix</code> anpassen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ratings_a</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">inner_join</span><span class="op">(</span><span class="va">ratings_b</span>, by <span class="op">=</span> <span class="st">"customer_id"</span>, suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"_store"</span>, <span class="st">"_online"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  customer_id rating_store rating_online
        &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
1           1            4             3
2           2            5             4</code></pre>
</div>
</div>
</section></section><section id="sec-joining-data-zusammenfassung" class="level2" data-number="13.8"><h2 data-number="13.8" class="anchored" data-anchor-id="sec-joining-data-zusammenfassung">
<span class="header-section-number">13.8</span> Kurz zusammengefasst</h2>
<ul>
<li>Joins verbinden zwei Tabellen über gemeinsame Schlüsselspalten.</li>
<li>
<code>inner_join()</code> behält nur Zeilen mit Treffern in beiden Tabellen.</li>
<li>
<code>left_join()</code> behält alle Zeilen der linken Tabelle, ist der häufigste Join-Typ.</li>
<li>
<code>right_join()</code> und <code>full_join()</code> behalten Zeilen der rechten beziehungsweise beider Tabellen.</li>
<li>Gebt den Schlüssel immer explizit mit <code>by</code> an. Bei unterschiedlichen Spaltennamen nutzt <code>join_by()</code>.</li>
<li>
<code>semi_join()</code> und <code>anti_join()</code> filtern die linke Tabelle, ohne Spalten hinzuzufügen.</li>
<li>Prüft nach jedem Join die Zeilenzahl mit <code><a href="https://rdrr.io/r/base/nrow.html">nrow()</a></code>, um unerwartete Duplikate zu erkennen.</li>
</ul>
<p>Damit habt ihr alle wichtigen Werkzeuge für die Datentransformation kennengelernt. Ihr wisst, wie ihr Daten ladet (siehe <a href="loading-data.html" class="quarto-xref"><span>Kapitel 5</span></a>), Spalten auswählt (siehe <a href="select.html" class="quarto-xref"><span>Kapitel 8</span></a>), Variablen verändert und neue berechnet (siehe <a href="mutate-modify.html" class="quarto-xref"><span>Kapitel 9</span></a> und <a href="mutate-add.html" class="quarto-xref"><span>Kapitel 10</span></a>), Zeilen filtert (siehe <a href="filter.html" class="quarto-xref"><span>Kapitel 11</span></a>), Daten zusammenfasst (siehe <a href="summarize.html" class="quarto-xref"><span>Kapitel 12</span></a>) und Tabellen verbindet. Im nächsten Teil des Buches geht es darum, eure Ergebnisse sichtbar zu machen: mit Datenvisualisierungen.</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Kopiert");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Kopiert");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../03-data-transformation/summarize.html" class="pagination-link" aria-label="Beobachtungen zusammenfassen">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Beobachtungen zusammenfassen</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../04-data-visualization/grammar-of-graphics.html" class="pagination-link" aria-label="Grammar of Graphics">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Grammar of Graphics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>