<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="de" xml:lang="de"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.9.20">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>14&nbsp; Grammar of Graphics – Hands-On Exploratory Data Analytics</title>
<style>
/* Default styles provided by pandoc.
** See https://pandoc.org/MANUAL.html#variables-for-html for config info.
*/
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../04-data-visualization/bar-charts.html" rel="next">
<link href="../03-data-transformation/joining-data.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-3512cbed9e2527d986e9b0b56d261405.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-2aba14264cc3e83a53bc9b44aa83aa68.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Keine Treffer",
    "search-matching-documents-text": "Treffer",
    "search-copy-link-title": "Link in die Suche kopieren",
    "search-hide-matches-text": "Zusätzliche Treffer verbergen",
    "search-more-match-text": "weitere Treffer in diesem Dokument",
    "search-more-matches-text": "weitere Treffer in diesem Dokument",
    "search-clear-button-title": "Zurücksetzen",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Abbrechen",
    "search-submit-button-title": "Abschicken",
    "search-label": "Suchen"
  }
}</script><link rel="stylesheet" href="../styles/sidebar.css">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../04-data-visualization/grammar-of-graphics.html">Datenvisualisierung</a></li><li class="breadcrumb-item"><a href="../04-data-visualization/grammar-of-graphics.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Grammar of Graphics</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Seitenleiste umschalten" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Suchen" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Hands-On Exploratory Data Analytics</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Suchen"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Vorwort</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Hintergründe</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../01-background/empirical-research.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Empirische Forschung</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Erste Schritte mit R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-r-basics/ide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Entwicklungsumgebung</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-r-basics/programming-with-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Programmieren mit R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../02-r-basics/data-representation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Datenrepräsentation</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Datentransformation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/loading-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Daten laden</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/pipe.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Pipe-Operator</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/exploring-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Daten kennenlernen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/select.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Variablen auswählen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/mutate-modify.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Variablen verändern</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/mutate-add.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Variablen erstellen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/filter.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Beobachtungen auswählen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/summarize.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Beobachtungen zusammenfassen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../03-data-transformation/joining-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Datensätze verbinden</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Datenvisualisierung</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/grammar-of-graphics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Grammar of Graphics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/bar-charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Balkendiagramme</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/scatter-plots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Punktediagramme</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/histograms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Histogramme</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/boxplots.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Boxplots</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/line-charts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Liniendiagramme</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../04-data-visualization/visualizations-polish.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Visualisuerungen polieren</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Projekt 1: Umfragen</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-1-survey/survey-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Umfragedaten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-1-survey/types-of-variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Arten von Variablen</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Projekt 2: News</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Abschnitt umschalten">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-2-news/load.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Laden der Daten</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-2-news/factors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Faktoren</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-2-news/variables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Übersicht der Variablen</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../project-2-news/time.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Zeit</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendix/appendix-a-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anhang A: Scraping</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../appendix/appendix-b-supplemental.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Anhang A: Material</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Quellen</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Inhaltsverzeichnis</h2>
   
  <ul>
<li><a href="#die-idee" id="toc-die-idee" class="nav-link active" data-scroll-target="#die-idee"><span class="header-section-number">14.1</span> Die Idee</a></li>
  <li>
<a href="#die-drei-essenziellen-bausteine" id="toc-die-drei-essenziellen-bausteine" class="nav-link" data-scroll-target="#die-drei-essenziellen-bausteine"><span class="header-section-number">14.2</span> Die drei essenziellen Bausteine</a>
  <ul class="collapse">
<li><a href="#daten" id="toc-daten" class="nav-link" data-scroll-target="#daten">Daten</a></li>
  <li><a href="#aesthetic-mappings" id="toc-aesthetic-mappings" class="nav-link" data-scroll-target="#aesthetic-mappings">Aesthetic Mappings</a></li>
  <li><a href="#geometrien" id="toc-geometrien" class="nav-link" data-scroll-target="#geometrien">Geometrien</a></li>
  </ul>
</li>
  <li>
<a href="#die-weiteren-ebenen" id="toc-die-weiteren-ebenen" class="nav-link" data-scroll-target="#die-weiteren-ebenen"><span class="header-section-number">14.3</span> Die weiteren Ebenen</a>
  <ul class="collapse">
<li><a href="#statistische-transformationen" id="toc-statistische-transformationen" class="nav-link" data-scroll-target="#statistische-transformationen">Statistische Transformationen</a></li>
  <li><a href="#skalen" id="toc-skalen" class="nav-link" data-scroll-target="#skalen">Skalen</a></li>
  <li><a href="#koordinatensysteme" id="toc-koordinatensysteme" class="nav-link" data-scroll-target="#koordinatensysteme">Koordinatensysteme</a></li>
  <li><a href="#facetten" id="toc-facetten" class="nav-link" data-scroll-target="#facetten">Facetten</a></li>
  <li><a href="#themes" id="toc-themes" class="nav-link" data-scroll-target="#themes">Themes</a></li>
  </ul>
</li>
  <li><a href="#alles-zusammen" id="toc-alles-zusammen" class="nav-link" data-scroll-target="#alles-zusammen"><span class="header-section-number">14.4</span> Alles zusammen</a></li>
  <li><a href="#der-typische-ablauf" id="toc-der-typische-ablauf" class="nav-link" data-scroll-target="#der-typische-ablauf"><span class="header-section-number">14.5</span> Der typische Ablauf</a></li>
  <li><a href="#kurz-zusammengefasst" id="toc-kurz-zusammengefasst" class="nav-link" data-scroll-target="#kurz-zusammengefasst"><span class="header-section-number">14.6</span> Kurz zusammengefasst</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../04-data-visualization/grammar-of-graphics.html">Datenvisualisierung</a></li><li class="breadcrumb-item"><a href="../04-data-visualization/grammar-of-graphics.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Grammar of Graphics</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-grammar-of-graphics" class="quarto-section-identifier"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Grammar of Graphics</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p>Bis hierhin habt ihr gelernt, Daten zu laden, zu filtern, zu verändern und zusammenzufassen. Jetzt kommt der Schritt, auf den viele am meisten warten: die Visualisierung. Denn ein gutes Diagramm zeigt in Sekunden, wofür ihr sonst Dutzende Zahlen lesen müsstet.</p>
<p>In R nutzen wir dafür <code>ggplot2</code>, das meistgenutzte Visualisierungspaket. Der Name steht für <em>Grammar of Graphics</em>, ein Konzept, das die Art und Weise, wie wir über Diagramme denken, grundlegend verändert hat. Statt einzelne Diagrammtypen auswendig zu lernen (Balkendiagramm, Liniendiagramm, Streudiagramm …), beschreibt ihr ein Diagramm als Kombination aus Bausteinen. Und genau diese Denkweise macht <code>ggplot2</code> so mächtig.</p>
<div id="gog-learning-objectives" class="reuse">
<ul>
<li>Was ist die Grammar of Graphics, und warum denken wir in Ebenen statt in Diagrammtypen?</li>
<li>Welche drei Bausteine braucht jedes Diagramm in <code>ggplot2</code>?</li>
<li>Welche weiteren Ebenen gibt es, und wann spielen sie eine Rolle?</li>
</ul>
</div>
<section id="die-idee" class="level2" data-number="14.1"><h2 data-number="14.1" class="anchored" data-anchor-id="die-idee">
<span class="header-section-number">14.1</span> Die Idee</h2>
<p>Die Grammar of Graphics stammt aus dem Buch <em>The Grammar of Graphics</em> von Leland Wilkinson (1999). Die Grundidee: Jedes statistische Diagramm lässt sich als Kombination unabhängiger Bausteine beschreiben, genau wie ein Satz in einer natürlichen Sprache aus Subjekt, Verb und Objekt besteht.</p>
<p>Hadley Wickham hat diese Idee aufgegriffen und in <code>ggplot2</code> umgesetzt. In <code>ggplot2</code> baut ihr ein Diagramm Schicht für Schicht auf, indem ihr Bausteine mit dem <code>+</code>-Operator verbindet.</p>
<p>Die wichtigste Erkenntnis dabei ist: Ein Balkendiagramm und ein Liniendiagramm unterscheiden sich nicht grundlegend. Beide haben Daten, eine Zuordnung von Variablen zu visuellen Eigenschaften und eine geometrische Form. Der einzige Unterschied ist die Form: Balken statt Linie. Wenn ihr das verinnerlicht habt, könnt ihr jedes Diagramm bauen, das ihr euch vorstellen könnt.</p>
</section><section id="die-drei-essenziellen-bausteine" class="level2" data-number="14.2"><h2 data-number="14.2" class="anchored" data-anchor-id="die-drei-essenziellen-bausteine">
<span class="header-section-number">14.2</span> Die drei essenziellen Bausteine</h2>
<p>Jedes Diagramm in <code>ggplot2</code> braucht exakt drei Dinge:</p>
<ol type="1">
<li>
<strong>Daten</strong> (data): Welcher Datensatz wird dargestellt?</li>
<li>
<strong>Zuordnungen</strong> (aesthetic mappings): Welche Variable wird auf welche visuelle Eigenschaft abgebildet?</li>
<li>
<strong>Geometrien</strong> (geoms): Welche geometrische Form stellt die Daten dar?</li>
</ol>
<p>Schauen wir uns das an einem Beispiel an. Wir wollen wissen, welche Accounts am meisten twittern. Dafür bereiten wir kurz die Top-10-Accounts vor und zeigen sie als Balkendiagramm:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">top_accounts</span> <span class="op">&lt;-</span> <span class="va">tweets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">screen_name</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">top_accounts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">screen_name</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-first-bar" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-first-bar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-first-bar-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-first-bar-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.1: Ein einfaches Balkendiagramm: Daten, Mapping, Geometrie.
</figcaption></figure>
</div>
</div>
</div>
<p>Drei Zeilen, drei Bausteine, drei <code>+</code>:</p>
<ul>
<li>
<code>top_accounts |&gt; ggplot()</code> übergibt den Datensatz per Pipe.</li>
<li>
<code>aes(x = screen_name, y = n)</code> ist das Mapping: Der Accountname auf die x-Achse, die Anzahl auf die y-Achse.</li>
<li>
<code>geom_col()</code> zeichnet Balken mit den vorberechneten Werten.</li>
</ul>
<p>Das Ergebnis sieht noch nicht besonders schön aus (die Namen überlappen sich, die Reihenfolge ist alphabetisch statt nach Häufigkeit), aber es ist ein vollständiges Diagramm. Alles, was danach kommt, ist Feinschliff.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Warum diese Schreibweise?">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tipp</span>Warum diese Schreibweise?
</div>
</div>
<div class="callout-body-container callout-body">
<p>In vielen Tutorials seht ihr <code>aes()</code> <em>innerhalb</em> von <code>ggplot()</code>, zum Beispiel <code>ggplot(data, aes(x = ..., y = ...))</code>. Das funktioniert genauso, denn <code>ggplot2</code> ist sehr flexibel. In diesem Buch schreiben wir jede Ebene als eigenen Baustein mit <code>+</code>, weil es die Idee der Grammar of Graphics am deutlichsten zeigt: Jede Zeile ist eine eigene Schicht, die ihr unabhängig ändern, entfernen oder ersetzen könnt.</p>
</div>
</div>
<section id="daten" class="level3"><h3 class="anchored" data-anchor-id="daten">Daten</h3>
<p>Der Datensatz ist immer ein Tibble oder Data Frame. Ihr übergebt ihn per Pipe an <code>ggplot()</code>. Oft kommt er direkt aus einer Aufbereitungskette:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_retweet</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">screen_name</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">screen_name</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-pipe" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-pipe-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-pipe-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-pipe-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.2: Der Datensatz kommt direkt aus einer Pipe-Kette.
</figcaption></figure>
</div>
</div>
</div>
<p>Beachtet den Wechsel: Innerhalb der Datenaufbereitung nutzt ihr <code>|&gt;</code>, aber ab <code>ggplot()</code> wechselt ihr zu <code>+</code>. Das liegt daran, dass <code>ggplot2</code> seine eigene Verkettungslogik hat. Das <code>+</code> fügt Ebenen zum Diagramm hinzu.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Pipe und Plus">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tipp</span>Pipe und Plus
</div>
</div>
<div class="callout-body-container callout-body">
<p>Solange ihr mit dem Datensatz arbeitet, pipt ihr (<code>|&gt;</code>). Sobald ihr am Diagramm arbeitet, plust ihr (<code>+</code>). Die Grenze ist <code>ggplot()</code>.</p>
</div>
</div>
</section><section id="aesthetic-mappings" class="level3"><h3 class="anchored" data-anchor-id="aesthetic-mappings">Aesthetic Mappings</h3>
<p>Das Mapping (<code>aes()</code>) ist das Herzstück. Es sagt <code>ggplot2</code>, welche Variable auf welche visuelle Eigenschaft abgebildet wird. Die häufigsten Aesthetics sind:</p>
<table class="caption-top table">
<thead><tr class="header">
<th>Aesthetic</th>
<th>Beschreibung</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>x</code></td>
<td>Position auf der x-Achse</td>
</tr>
<tr class="even">
<td><code>y</code></td>
<td>Position auf der y-Achse</td>
</tr>
<tr class="odd">
<td><code>color</code></td>
<td>Farbe (Linien, Punkte)</td>
</tr>
<tr class="even">
<td><code>fill</code></td>
<td>Füllfarbe (Balken, Flächen)</td>
</tr>
<tr class="odd">
<td><code>size</code></td>
<td>Größe</td>
</tr>
<tr class="even">
<td><code>shape</code></td>
<td>Form (Punkte)</td>
</tr>
<tr class="odd">
<td><code>alpha</code></td>
<td>Transparenz</td>
</tr>
</tbody>
</table>
<p>Im Beispiel oben haben wir <code>x</code> und <code>y</code> verwendet. Probieren wir ein Beispiel mit <code>fill</code>, um die Balken nach einer zweiten Variable einzufärben:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">screen_name</span>, <span class="va">is_retweet</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">screen_name</span>, y <span class="op">=</span> <span class="va">n</span>, fill <span class="op">=</span> <span class="va">is_retweet</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-fill" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-fill-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-fill-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-fill-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.3: Mit fill werden die Balken nach einer zweiten Variable eingefärbt.
</figcaption></figure>
</div>
</div>
</div>
<p>Jetzt sehen wir für jeden Account, wie viele Original-Tweets und wie viele Retweets es gibt. <code>ggplot2</code> erstellt automatisch eine Legende. Das ist die Stärke des Mapping-Konzepts: Ihr beschreibt <em>was</em> dargestellt werden soll, nicht <em>wie</em> es aussehen soll.</p>
</section><section id="geometrien" class="level3"><h3 class="anchored" data-anchor-id="geometrien">Geometrien</h3>
<p>Die Geometrie bestimmt die visuelle Form. Jede <code>geom_*</code>-Funktion zeichnet eine andere Art von Grafik. Hier sind die wichtigsten:</p>
<table class="caption-top table">
<thead><tr class="header">
<th>Geom</th>
<th>Darstellung</th>
<th>Typischer Einsatz</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>geom_bar()</code></td>
<td>Balken</td>
<td>Häufigkeiten zählen</td>
</tr>
<tr class="even">
<td><code>geom_col()</code></td>
<td>Balken</td>
<td>Vorberechnete Werte darstellen</td>
</tr>
<tr class="odd">
<td><code>geom_point()</code></td>
<td>Punkte</td>
<td>Streudiagramme</td>
</tr>
<tr class="even">
<td><code>geom_line()</code></td>
<td>Linien</td>
<td>Zeitreihen</td>
</tr>
<tr class="odd">
<td><code>geom_histogram()</code></td>
<td>Histogramm</td>
<td>Verteilungen</td>
</tr>
<tr class="even">
<td><code>geom_boxplot()</code></td>
<td>Boxplot</td>
<td>Verteilungsvergleiche</td>
</tr>
</tbody>
</table>
<p>Der Unterschied zwischen <code>geom_bar()</code> und <code>geom_col()</code> ist wichtig: <code>geom_bar()</code> zählt die Häufigkeit selbst, <code>geom_col()</code> erwartet, dass ihr den y-Wert schon berechnet habt.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">screen_name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-bar-vs-col" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-bar-vs-col-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-bar-vs-col-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-bar-vs-col-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.4: geom_bar() zählt selbst, geom_col() nimmt vorberechnete Werte.
</figcaption></figure>
</div>
</div>
</div>
<p>Hier zählt <code>geom_bar()</code> die Häufigkeit jedes Accountnamens selbst. Das Ergebnis ist unübersichtlich, weil es sehr viele Accounts gibt. In der Praxis bereitet ihr die Daten deshalb vorher auf und nutzt <code>geom_col()</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">top_accounts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">screen_name</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-col" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-col-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-col-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-col-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.5: geom_col() braucht einen vorberechneten y-Wert.
</figcaption></figure>
</div>
</div>
</div>
<p><em>Abbildung: Drei Karten nebeneinander, die die drei essenziellen Bausteine zeigen. Karte 1: “Data” mit einem Tabellensymbol und dem Label “top_accounts”. Karte 2: “Mapping” mit dem Label “aes(x = screen_name, y = n)” und Pfeilen von den Variablen zu den Achsen. Karte 3: “Geom” mit dem Label “geom_col()” und einer kleinen Balkengrafik. Unter den drei Karten steht ein Pluszeichen zwischen jeder Karte, und darunter das fertige Diagramm.</em></p>
</section></section><section id="die-weiteren-ebenen" class="level2" data-number="14.3"><h2 data-number="14.3" class="anchored" data-anchor-id="die-weiteren-ebenen">
<span class="header-section-number">14.3</span> Die weiteren Ebenen</h2>
<p>Neben den drei essenziellen Bausteinen kennt die Grammar of Graphics noch weitere Ebenen. Diese sind optional und dienen dazu, das Diagramm zu verfeinern. Ihr müsst sie nicht für jedes Diagramm kennen, aber es hilft zu wissen, dass sie existieren.</p>
<section id="statistische-transformationen" class="level3"><h3 class="anchored" data-anchor-id="statistische-transformationen">Statistische Transformationen</h3>
<p>Manchmal wollt ihr die Daten nicht direkt darstellen, sondern erst eine statistische Zusammenfassung berechnen. Tatsächlich tut <code>geom_bar()</code> genau das bereits: Es zählt die Häufigkeiten für euch. Hinter jeder Geometrie steckt eine statistische Transformation (<code>stat</code>).</p>
<p>In den meisten Fällen müsst ihr euch darum nicht kümmern, weil die Geoms eine sinnvolle Voreinstellung mitbringen. Es gibt aber Situationen, in denen ihr die Statistik explizit wechseln wollt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">top_accounts</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">screen_name</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-stat-identity" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-stat-identity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-stat-identity-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-stat-identity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.6: Mit stat = ‘identity’ nimmt geom_bar() die Werte direkt, statt zu zählen.
</figcaption></figure>
</div>
</div>
</div>
<p>Das ist gleichbedeutend mit <code>geom_col()</code>. In der Praxis nutzt ihr fast immer die Standardeinstellung und greift nur ein, wenn ihr einen speziellen Fall habt.</p>
</section><section id="skalen" class="level3"><h3 class="anchored" data-anchor-id="skalen">Skalen</h3>
<p>Skalen (<code>scale_*</code>) steuern, wie die Werte auf visuelle Eigenschaften abgebildet werden. Zum Beispiel, welche Farben verwendet werden oder wie die Achsen beschriftet sind.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_retweet</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lang</span>, fill <span class="op">=</span> <span class="va">lang</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set2"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-scale" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-scale-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-scale-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.7: Skalen steuern Farben und Achsenbeschriftungen.
</figcaption></figure>
</div>
</div>
</div>
<p>Auch hier gilt: Die Standardeinstellungen sind meistens ausreichend. Skalen werden vor allem dann wichtig, wenn ihr Farben anpassen, Achsen formatieren oder Legenden steuern wollt. Das vertiefen wir im Kapitel über das Verfeinern von Diagrammen.</p>
</section><section id="koordinatensysteme" class="level3"><h3 class="anchored" data-anchor-id="koordinatensysteme">Koordinatensysteme</h3>
<p>Das Koordinatensystem bestimmt, wie x und y auf die Fläche abgebildet werden. Das Standard-Koordinatensystem ist kartesisch (rechtwinklig). Für manche Diagramme ist ein anderes System sinnvoller:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_retweet</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lang</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-coord-flip" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-coord-flip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-coord-flip-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-coord-flip-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.8: coord_flip() dreht die Achsen um 90 Grad.
</figcaption></figure>
</div>
</div>
</div>
<p><code>coord_flip()</code> tauscht x- und y-Achse. Das macht Balkendiagramme mit langen Beschriftungen lesbarer. Es gibt auch <code>coord_polar()</code> für Kreisdiagramme, aber die werden in der explorativen Analyse selten gebraucht.</p>
</section><section id="facetten" class="level3"><h3 class="anchored" data-anchor-id="facetten">Facetten</h3>
<p>Facetten teilen ein Diagramm in mehrere kleine Teildiagramme auf, eines pro Ausprägung einer Variable. Das ist nützlich, um Vergleiche übersichtlich darzustellen:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_retweet</span>, <span class="va">lang</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"de"</span>, <span class="st">"en"</span>, <span class="st">"fr"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">retweet_count</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_wrap</span><span class="op">(</span><span class="op">~</span> <span class="va">lang</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-facet" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-facet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-facet-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-facet-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.9: Facetten erzeugen ein Teildiagramm pro Sprache.
</figcaption></figure>
</div>
</div>
</div>
<p><code>facet_wrap(~ lang)</code> erstellt ein Histogramm pro Sprache. Das ist oft aussagekräftiger als ein einzelnes Diagramm mit Farbcodierung, weil die Teildiagramme leichter zu vergleichen sind.</p>
</section><section id="themes" class="level3"><h3 class="anchored" data-anchor-id="themes">Themes</h3>
<p>Themes steuern das Gesamtaussehen des Diagramms: Hintergrundfarbe, Schriftart, Gitterlinien und so weiter. Sie haben nichts mit den Daten zu tun, sondern nur mit der Optik.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_retweet</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">lang</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_minimal</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-theme" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-theme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-theme-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-theme-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.10: Verschiedene Themes ändern das Aussehen, nicht die Daten.
</figcaption></figure>
</div>
</div>
</div>
<p><code>ggplot2</code> bringt mehrere Themes mit: <code>theme_minimal()</code>, <code>theme_classic()</code>, <code>theme_light()</code>, <code>theme_dark()</code> und andere. Im Kapitel über das Verfeinern von Diagrammen gehen wir ausführlicher darauf ein.</p>
</section></section><section id="alles-zusammen" class="level2" data-number="14.4"><h2 data-number="14.4" class="anchored" data-anchor-id="alles-zusammen">
<span class="header-section-number">14.4</span> Alles zusammen</h2>
<p>Hier ist die vollständige Schichtung, die die Grammar of Graphics beschreibt:</p>
<table class="caption-top table">
<thead><tr class="header">
<th>Ebene</th>
<th>Funktion in ggplot2</th>
<th>Rolle</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><strong>Daten</strong></td>
<td><code>data |&gt; ggplot()</code></td>
<td>Was wird dargestellt?</td>
</tr>
<tr class="even">
<td><strong>Mapping</strong></td>
<td><code>aes(...)</code></td>
<td>Welche Variable wird wohin abgebildet?</td>
</tr>
<tr class="odd">
<td><strong>Geometrie</strong></td>
<td><code>geom_*()</code></td>
<td>Welche Form?</td>
</tr>
<tr class="even">
<td>Statistik</td>
<td><code>stat_*()</code></td>
<td>Welche Berechnung? (meist automatisch)</td>
</tr>
<tr class="odd">
<td>Skalen</td>
<td><code>scale_*()</code></td>
<td>Wie werden Werte in Optik übersetzt?</td>
</tr>
<tr class="even">
<td>Koordinaten</td>
<td><code>coord_*()</code></td>
<td>Welches Koordinatensystem?</td>
</tr>
<tr class="odd">
<td>Facetten</td>
<td><code>facet_*()</code></td>
<td>Aufteilen in Teildiagramme?</td>
</tr>
<tr class="even">
<td>Theme</td>
<td><code>theme_*()</code></td>
<td>Wie sieht es insgesamt aus?</td>
</tr>
</tbody>
</table>
<p>Die ersten drei Zeilen (fett) braucht ihr immer. Der Rest ist optional und dient dazu, das Diagramm zu verfeinern. Für die explorative Analyse reicht es oft völlig, nur die drei essenziellen Bausteine zu verwenden und den Rest den Standards zu überlassen.</p>
<p><em>Abbildung: Ein Schichtenmodell wie ein Stapel Folien oder ein Sandwich von unten nach oben. Ganz unten liegt die Schicht “Data” (blau). Darüber “Mapping / Aesthetics” (grün). Darüber “Geom” (orange). Darüber, etwas abgesetzt und leicht transparent: “Stat” (grau), “Scale” (grau), “Coord” (grau), “Facet” (grau), “Theme” (grau). Die unteren drei Schichten sind groß und kräftig gefärbt, die oberen fünf kleiner und dezent. Eine Klammer links umfasst die unteren drei mit der Beschriftung “Essenziell”. Eine Klammer rechts umfasst die oberen fünf mit der Beschriftung “Verfeinern”.</em></p>
</section><section id="der-typische-ablauf" class="level2" data-number="14.5"><h2 data-number="14.5" class="anchored" data-anchor-id="der-typische-ablauf">
<span class="header-section-number">14.5</span> Der typische Ablauf</h2>
<p>In der Praxis baut ihr ein Diagramm fast immer so auf:</p>
<ol type="1">
<li>Daten aufbereiten (filtern, gruppieren, zusammenfassen)</li>
<li>
<code>ggplot()</code> aufrufen und das Mapping festlegen</li>
<li>Geometrie hinzufügen</li>
<li>Bei Bedarf verfeinern (Achsen, Farben, Theme)</li>
</ol>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tweets</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="va">is_retweet</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">screen_name</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html">reorder</a></span><span class="op">(</span><span class="va">screen_name</span>, <span class="va">n</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_col</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Account"</span>, y <span class="op">=</span> <span class="st">"Tweets"</span><span class="op">)</span></span></code></pre></div><button title="In die Zwischenablage kopieren" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div id="fig-gog-workflow" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-gog-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="grammar-of-graphics_files/figure-html/fig-gog-workflow-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-gog-workflow-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Abbildung&nbsp;14.11: Ein typischer Ablauf: Daten aufbereiten, dann visualisieren.
</figcaption></figure>
</div>
</div>
</div>
<p>Hier sehen wir die Pipe-Kette und <code>ggplot2</code> zusammenarbeiten: Erst filtern wir, dann zählen wir die Tweets pro Account, nehmen die Top 10 und visualisieren sie als horizontales Balkendiagramm. <code>reorder(screen_name, n)</code> sortiert die Balken nach Häufigkeit statt alphabetisch.</p>
</section><section id="kurz-zusammengefasst" class="level2" data-number="14.6"><h2 data-number="14.6" class="anchored" data-anchor-id="kurz-zusammengefasst">
<span class="header-section-number">14.6</span> Kurz zusammengefasst</h2>
<ul>
<li>Die Grammar of Graphics beschreibt Diagramme als Kombination unabhängiger Bausteine.</li>
<li>Jedes Diagramm in <code>ggplot2</code> braucht drei Dinge: Daten (<code>data</code>), Zuordnungen (<code>aes()</code>) und eine Geometrie (<code>geom_*()</code>).</li>
<li>Weitere Ebenen wie Skalen, Koordinaten, Facetten und Themes verfeinern das Diagramm, sind aber optional.</li>
<li>Innerhalb der Datenaufbereitung nutzt ihr <code>|&gt;</code>, ab <code>ggplot()</code> nutzt ihr <code>+</code>.</li>
<li>
<code>geom_bar()</code> zählt Häufigkeiten selbst, <code>geom_col()</code> erwartet vorberechnete Werte.</li>
<li>Facetten (<code>facet_wrap()</code>) teilen ein Diagramm in Teildiagramme auf und erleichtern Vergleiche.</li>
</ul>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Kopiert");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Kopiert");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../03-data-transformation/joining-data.html" class="pagination-link" aria-label="Datensätze verbinden">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Datensätze verbinden</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../04-data-visualization/bar-charts.html" class="pagination-link" aria-label="Balkendiagramme">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Balkendiagramme</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>